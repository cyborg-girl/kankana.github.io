<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Style Transfer | Portfolio Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- CVless theme dark colors -->
<style>
  :root{
    --bg:#0d0d0d; --card:rgba(29,53,87,0.85); --accent:#4cc9f0; --muted:#bfc9d9;
  }
  html,body{height:100%; margin:0; background:var(--bg); color:#fff; font-family:"Inter","Helvetica Neue",Arial,sans-serif;}
  #particles-js{position:fixed; inset:0; z-index:-1;}
  .wrap{min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:48px 20px;}
  .card{width:100%; max-width:1200px; background:var(--card); border-radius:16px; padding:28px; box-shadow:0 12px 40px rgba(0,0,0,0.6); display:grid; gap:18px; grid-template-columns: 1fr 1fr; align-items:start;}
  h1{color:var(--accent); margin:0 0 12px;}
  .section{margin-bottom:20px;}
  .input-preview,.style-preview,.output-preview{border-radius:12px; background:#111; width:100%; height:320px; display:flex; align-items:center; justify-content:center; overflow:hidden; margin-bottom:12px; box-shadow: inset 0 0 40px rgba(0,0,0,0.6);}
  .input-preview img,.style-preview img,.output-preview img{width:100%; height:100%; object-fit:cover;}
  .thumbnails{display:flex; flex-wrap:wrap; gap:8px;}
  .thumbnails img{width:80px; height:80px; object-fit:cover; cursor:pointer; border-radius:8px; transition:0.2s; border:2px solid transparent;}
  .thumbnails img.selected{border-color:var(--accent);}
  .btn{background:linear-gradient(135deg,var(--accent),#4895ef); color:#0b1020; padding:10px 16px; border-radius:10px; font-weight:700; border:none; cursor:pointer;}
  .status{margin-top:10px;color:var(--muted);}
</style>

<!-- Libraries -->
<script src="/home/libraries/p5.min.js"></script>
<script src="/home/libraries/p5.dom.min.js"></script>
<script src="/home/libraries/ml5.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
</head>
<body>

<div id="particles-js"></div>

<div class="wrap">
  <h1>ðŸŽ¨ Fast Style Transfer</h1>
  <div class="card">

    <!-- Input Section -->
    <div class="section">
      <h2>Input</h2>
      <div class="input-preview" id="input-preview">
        <span class="muted">No image selected</span>
      </div>
      <input type="file" id="input-upload" accept="image/*">
      <button class="btn" onclick="useWebcam()">Use Webcam</button>
      <div class="status" id="input-status"></div>
    </div>

    <!-- Style Section -->
    <div class="section">
      <h2>Style</h2>
      <div class="style-preview" id="style-preview">
        <span class="muted">No style selected</span>
      </div>
      <div class="thumbnails" id="style-thumbnails"></div>
      <button class="btn" id="transfer-btn" onclick="transferStyle()" disabled>Transfer Style</button>
      <div class="status" id="style-status"></div>
    </div>

    <!-- Output Section -->
    <div class="section">
      <h2>Output</h2>
      <div class="output-preview" id="output-preview">
        <span class="muted">Results will appear here</span>
      </div>
    </div>

  </div>
</div>

<script>
  // Particles.js animation
  particlesJS("particles-js", {
    particles:{number:{value:70}, size:{value:3}, move:{speed:1}, line_linked:{enable:true, distance:140, color:"#4cc9f0"}, color:{value:"#4cc9f0"}},
    interactivity:{events:{onhover:{enable:true, mode:"repulse"}}}
  });

  let styleTransfer;
  let inputImgElement;
  let selectedStyleModel = null;

  // Detect available images automatically
  const inputImages = [
    "girlwithpearl.jpg",
    "starrynight.jpg",
    "sunflower.jpg",
    "monalisa.jpg"
  ];
  const styleImages = [
    "udnie.jpg",
    "rain_princess.jpg",
    "scream.jpg",
    "wave.jpg"
  ];

  const styleThumbnailsContainer = document.getElementById("style-thumbnails");
  const stylePreview = document.getElementById("style-preview");
  const transferBtn = document.getElementById("transfer-btn");

  // Populate style thumbnails
  styleImages.forEach(name=>{
    const img = document.createElement("img");
    img.src = "/home/images/" + name;
    img.title = name.split(".")[0];
    img.onclick = () => selectStyle(img, name);
    styleThumbnailsContainer.appendChild(img);
  });

  function selectStyle(img, name){
    // highlight
    document.querySelectorAll("#style-thumbnails img").forEach(i=>i.classList.remove("selected"));
    img.classList.add("selected");
    stylePreview.innerHTML="";
    const previewImg = document.createElement("img");
    previewImg.src = img.src;
    stylePreview.appendChild(previewImg);
    selectedStyleModel = "/home/models/" + name.split(".")[0] + "/";
    transferBtn.disabled=false;
  }

  // Input file upload
  const inputUpload = document.getElementById("input-upload");
  const inputPreview = document.getElementById("input-preview");
  inputUpload.addEventListener("change", e=>{
    const file = e.target.files[0];
    if(!file) return;
    const img = document.createElement("img");
    img.src = URL.createObjectURL(file);
    img.onload=()=>URL.revokeObjectURL(img.src);
    inputPreview.innerHTML="";
    inputPreview.appendChild(img);
    inputImgElement=img;
  });

  // Webcam capture
  function useWebcam(){
    const video = document.createElement("video");
    video.autoplay=true;
    video.muted=true;
    video.playsInline=true;
    navigator.mediaDevices.getUserMedia({video:true,audio:false}).then(stream=>{
      video.srcObject=stream;
      inputPreview.innerHTML="";
      inputPreview.appendChild(video);
      inputImgElement=video;
    }).catch(err=>{
      alert("Webcam not available or HTTPS required");
    });
  }

  // Style transfer
  async function transferStyle(){
    if(!selectedStyleModel || !inputImgElement) return;
    transferBtn.disabled=true;
    document.getElementById("style-status").textContent="Processing...";
    styleTransfer = ml5.styleTransfer(selectedStyleModel, () => {
      styleTransfer.transfer(inputImgElement, (err,result)=>{
        if(err){
          console.error(err);
          document.getElementById("style-status").textContent="Error";
        } else {
          const out = document.createElement("img");
          out.src=result.src;
          const outContainer=document.getElementById("output-preview");
          outContainer.innerHTML="";
          outContainer.appendChild(out);
          document.getElementById("style-status").textContent="Done!";
          transferBtn.disabled=false;
        }
      });
    });
  }

</script>
</body>
</html>
