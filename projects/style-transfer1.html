<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Style Transfer Demo</title>

  <!-- p5.js + ml5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.dom.min.js"></script>
  <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>

  <!-- particles.js -->
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #121212;
      color: #eee;
    }
    #particles-js {
      position: fixed;
      width: 100%;
      height: 100%;
      z-index: -1;
    }
    .container {
      display: flex;
      flex-direction: row;
      justify-content: space-around;
      padding: 20px;
    }
    .section {
      flex: 1;
      margin: 10px;
      background: #1e1e1e;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    h2 {
      text-align: center;
      margin-top: 0;
    }
    .thumb-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
      gap: 10px;
    }
    .thumb-grid img {
      width: 90px;
      height: 90px;
      object-fit: cover;
      border-radius: 6px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .thumb-grid img:hover {
      transform: scale(1.05);
      box-shadow: 0 0 8px #4cafef;
    }
    .preview {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
    }
    .preview img {
      max-width: 100%;
      max-height: 250px;
      border-radius: 8px;
    }
    button {
      display: block;
      margin: 15px auto;
      padding: 10px 20px;
      font-size: 16px;
      background: #4cafef;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #2196f3;
    }
    .output {
      text-align: center;
    }
    .output img {
      max-width: 100%;
      max-height: 300px;
      border-radius: 8px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div id="particles-js"></div>

  <div class="container">
    <!-- INPUT SECTION -->
    <div class="section">
      <h2>INPUT</h2>
      <div class="preview"><img id="input-img" style="display:none"/></div>
      <input type="file" id="uploader" accept="image/*">
      <div class="thumb-grid" id="input-thumbs"></div>
    </div>

    <!-- STYLE SECTION -->
    <div class="section">
      <h2>STYLE</h2>
      <div class="preview"><img id="style-img" style="display:none"/></div>
      <div class="thumb-grid" id="style-thumbs"></div>
      <button onclick="onPredictClick()">Transfer Style</button>
    </div>

    <!-- OUTPUT SECTION -->
    <div class="section output">
      <h2>OUTPUT</h2>
      <div id="output-img-container"></div>
    </div>
  </div>

  <script>
    // Example file arrays (replace with real server-side listing if possible)
    const inputImages = [
      "/home/images/girlwithpearl.jpg",
      "/home/images/starrynight.jpg",
      "/home/images/sunflower.jpg",
      "/home/images/monalisa.jpg"
    ];
    const styleImages = [
      "/home/images/wave.jpg",
      "/home/images/la_muse.jpg",
      "/home/images/rain_princess.jpg",
      "/home/images/udnie.jpg",
      "/home/images/wreck.jpg",
      "/home/images/scream.jpg"
    ];

    // Populate thumbnails
    function populateThumbnails(list, containerId, imgClick) {
      const container = document.getElementById(containerId);
      list.forEach(src => {
        const img = document.createElement("img");
        img.src = src;
        img.onclick = () => imgClick(src);
        container.appendChild(img);
      });
    }

    populateThumbnails(inputImages, "input-thumbs", (src) => {
      const inputImg = document.getElementById("input-img");
      inputImg.src = src;
      inputImg.style.display = "block";
    });

    populateThumbnails(styleImages, "style-thumbs", (src) => {
      const styleImg = document.getElementById("style-img");
      styleImg.src = src;
      styleImg.style.display = "block";
    });

    // Preview uploaded image
    document.getElementById("uploader").addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = ev => {
          const inputImg = document.getElementById("input-img");
          inputImg.src = ev.target.result;
          inputImg.style.display = "block";
        };
        reader.readAsDataURL(file);
      }
    });

    let styleTransfer;

    function onPredictClick() {
      const inputImg = document.getElementById("input-img");
      const styleImg = document.getElementById("style-img");
      const outputContainer = document.getElementById("output-img-container");

      if (!inputImg.src || inputImg.style.display === "none") {
        alert("Please select or upload an input image first.");
        return;
      }
      if (!styleImg.src || styleImg.style.display === "none") {
        alert("Please select a style image first.");
        return;
      }

      outputContainer.innerHTML = "Processing...";

      // assume model path is same as style image but without .jpg
      const modelPath = styleImg.src.replace(".jpg", "");
      styleTransfer = ml5.styleTransfer(modelPath, () => {
        styleTransfer.transfer(inputImg, (err, result) => {
          if (err) {
            console.error(err);
            outputContainer.innerHTML = "Error applying style.";
            return;
          }
          outputContainer.innerHTML = "";
          const outImg = document.createElement("img");
          outImg.src = result.src;
          outputContainer.appendChild(outImg);
        });
      });
    }

    // particles.js config
    particlesJS("particles-js", {
      "particles": {
        "number": { "value": 80 },
        "size": { "value": 3 },
        "move": { "speed": 2 },
        "line_linked": { "enable": true, "opacity": 0.2 }
      }
    });
  </script>
</body>
</html>
