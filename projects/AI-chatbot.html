<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Instruction-Based Custom AI Agent | Portfolio Demo</title>

<!-- CVless Dark Theme Styles -->
<style>
:root {
  --bg: #0d0d0d;
  --card: rgba(29,53,87,0.85);
  --accent: #4cc9f0;
  --muted: #bfc9d9;
  --highlight: #ffd166;
}

body {
  margin:0; padding:0;
  font-family: 'Inter', sans-serif;
  background: var(--bg);
  color: #fff;
  overflow-x:hidden;
}

#particles-js {
  position: fixed;
  inset: 0;
  z-index: -1;
}

.container {
  display: flex;
  gap: 30px;
  max-width: 1000px;
  margin: 80px auto;
  padding: 20px;
  animation: fadeIn 1s ease-out;
}

.instructions-column, .chat-column {
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  flex: 1;
  display: flex;
  flex-direction: column;
  max-height: 700px;
  overflow-y: auto;
  box-shadow: 0 12px 40px rgba(0,0,0,0.6);
}

.instructions-column h2, .chat-column h2 {
  color: var(--accent);
  margin-bottom: 12px;
  text-align: center;
}

.instructions-list div {
  background: rgba(255,255,255,0.05);
  padding: 10px 14px;
  margin-bottom: 8px;
  border-radius: 10px;
  cursor: default;
  transition: transform 0.2s ease, background 0.3s ease;
}

.instructions-list div.flash {
  background: var(--highlight);
  color: #000;
  transform: scale(1.05);
}

.add-instruction {
  display: flex;
  margin-bottom: 10px;
}

.add-instruction input {
  flex:1;
  padding: 8px 10px;
  border-radius: 8px;
  border: none;
  margin-right: 8px;
  background: #1a1a1a;
  color: #fff;
}

.add-instruction button {
  padding: 8px 12px;
  border-radius: 8px;
  border: none;
  background: var(--accent);
  color: #0b1020;
  font-weight: 700;
  cursor: pointer;
}

.chatbox {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  gap: 10px;
}

.chat-messages {
  flex: 1;
  overflow-y: auto;
  background: rgba(0,0,0,0.12);
  padding: 12px;
  border-radius: 12px;
}

.bot-msg, .user-msg {
  margin: 8px 0;
  padding: 8px 12px;
  border-radius: 12px;
  max-width: 80%;
  line-height: 1.4;
  animation: fadeInUp 0.6s ease;
}

.user-msg {
  background: var(--accent);
  color: #0b1020;
  align-self: flex-end;
  margin-left: auto;
}

.bot-msg {
  background: rgba(255,255,255,0.08);
  color: #fff;
  align-self: flex-start;
}

.bot-msg span {
  display: block;
  margin-top: 4px;
  font-size: 0.85rem;
  color: var(--muted);
}

input[type="text"] {
  width: calc(100% - 90px);
  padding: 10px 12px;
  border-radius: 10px;
  border: none;
  margin-right: 8px;
  font-size: 16px;
  background: #1a1a1a;
  color: #f1f1f1;
}

button.send-btn {
  padding: 10px 16px;
  border-radius: 10px;
  border: none;
  background: var(--accent);
  color: #0b1020;
  font-weight: 700;
  cursor: pointer;
  transition: transform 0.2s ease, background 0.3s ease;
}

button.send-btn:hover {
  transform: scale(1.05);
  background: #4895ef;
}

@keyframes fadeIn {
  from {opacity:0;}
  to {opacity:1;}
}

@keyframes fadeInUp {
  from {opacity:0; transform: translateY(10px);}
  to {opacity:1; transform: translateY(0);}
}
</style>
</head>
<body>

<div id="particles-js"></div>

<div class="container">

  <!-- Instructions Column -->
  <div class="instructions-column">
    <h2>Custom Instructions</h2>
    <div class="add-instruction">
      <input type="text" id="newInstruction" placeholder="Add new instruction...">
      <button id="addInstructionBtn">Add</button>
    </div>
    <div class="instructions-list" id="instructionsList"></div>
  </div>

  <!-- Chat Column -->
  <div class="chat-column">
    <h2>Chat with AI Agent</h2>
    <div class="chatbox">
      <div class="chat-messages" id="chatbox"></div>
      <div style="display:flex; margin-top:8px;">
        <input type="text" id="userInput" placeholder="Type your question..." />
        <button class="send-btn" id="sendBtn">Send</button>
      </div>
    </div>
  </div>

</div>

<!-- Particles.js -->
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script>
particlesJS("particles-js", {
  particles: {
    number:{value:70},
    size:{value:3},
    color:{value:"#4cc9f0"},
    move:{speed:1},
    line_linked:{enable:true, distance:140, color:"#4cc9f0"}
  },
  interactivity: { events:{ onhover:{ enable:true, mode:"repulse" }}}
});
</script>

<script>
// Base instructions
let instructions = [
  "The AI agent works only based on the instructions provided.",
  "It cannot answer questions outside its instructions."
];

const instructionsList = document.getElementById("instructionsList");
const chatbox = document.getElementById("chatbox");
const userInput = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");

const newInstructionInput = document.getElementById("newInstruction");
const addInstructionBtn = document.getElementById("addInstructionBtn");

// Render instructions
function renderInstructions() {
  instructionsList.innerHTML = "";
  instructions.forEach((inst, idx) => {
    const div = document.createElement("div");
    div.textContent = `${idx + 1}. ${inst}`;
    div.dataset.index = idx;
    instructionsList.appendChild(div);
  });
}

// Add new instruction
addInstructionBtn.onclick = () => {
  const val = newInstructionInput.value.trim();
  if(val) {
    instructions.push(val);
    newInstructionInput.value = "";
    renderInstructions();
  }
}

// Simple scoring function
function scoreMatch(query, instruction) {
  const qWords = query.toLowerCase().split(/\W+/);
  const iWords = instruction.toLowerCase().split(/\W+/);
  return iWords.filter(w => qWords.includes(w)).length;
}

// Get best matching instructions
function getRelevantInstructions(query) {
  let scored = instructions.map((inst, idx) => ({ inst, idx, score: scoreMatch(query, inst) }));
  scored.sort((a,b)=>b.score-a.score);
  if(scored[0].score === 0) return [];
  return [scored[0]];
}

// Flash highlight
function flashInstructions(indices) {
  indices.forEach(i => {
    const div = instructionsList.querySelector(`div[data-index="${i}"]`);
    if (div) {
      div.classList.add("flash");
      setTimeout(()=>div.classList.remove("flash"),600);
    }
  });
}

// Typing effect
async function typeMessage(msg, sources=[]) {
  const div = document.createElement("div");
  div.className = "bot-msg";
  chatbox.appendChild(div);
  for(let i=0;i<msg.length;i++){
    div.textContent+=msg[i];
    await new Promise(r=>setTimeout(r,20));
    chatbox.scrollTop = chatbox.scrollHeight;
  }
  if(sources.length>0){
    const span=document.createElement("span");
    span.textContent="Based on instruction(s): "+sources.map(s=>s.inst).join("; ");
    div.appendChild(span);
  }
}

// Send message
sendBtn.onclick = async () => {
  const q = userInput.value.trim();
  if(!q) return;
  const userDiv=document.createElement("div");
  userDiv.className="user-msg";
  userDiv.textContent=q;
  chatbox.appendChild(userDiv);
  chatbox.scrollTop=chatbox.scrollHeight;

  const relevant=getRelevantInstructions(q);
  let ans,sources;
  if(relevant.length===0){
    ans="I'm sorry, this question is outside the scope of the AI agent based on its instructions.";
    sources=[];
  } else {
    ans=relevant.map(r=>r.inst).join(" ");
    sources=relevant;
    flashInstructions(relevant.map(r=>r.idx));
  }
  await typeMessage(ans,sources);
  userInput.value="";
}

userInput.addEventListener("keypress", e=>{if(e.key==="Enter") sendBtn.click();});

renderInstructions();
</script>
</body>
</html>
